<div id="joke-container">
  <div id="question-container">
      <% if joke.user %>
        <%= link_to image_tag(joke.user.image, size: "48x48", class: "img-circle"), joke.user, class: "avatar avatar-left qtip-user", id: "question-avatar", title: joke.user.user_name, "data-user-id" => joke.user.id, "data-include-avatar" => "false"%>
      <% else %>
        <%= image_tag anon_user_icon, size: "48x48", class: "img-circle avatar avatar-left avatar-anon", title: "Anonymous author" %>
      <% end %>
    <span class="bubble" id="creator-avatar-bubble"></span>
    <p id="question" class="reveal-punchline question jumbotron" data-joke-id="<%= joke.id %>">
      <%= joke.question %>
    </p>
  </div>
  <p id="click-for-punchline" class="reveal-punchline jumbotron" data-joke-id="<%= joke.id %>">Click for the <strong>punchline</strong>!</p>
  <div id="answer-container">
    <p id="answer" class="answer jumbotron">
    <%= joke.answer %>
      <span class="bubble-right bubble bubble-answer" id="answer-avatar-bubble"></span>
      <% if joke.user %>
        <%= link_to image_tag(joke.user.image, size: "48x48", class: "img-circle"), joke.user, class: "avatar avatar-right qtip-user", id: "question-avatar", title: joke.user.user_name, "data-user-id" => joke.user.id, "data-include-avatar" => "false"%>
      <% else %>
        <%= image_tag anon_user_icon, size: "48x48", class: "img-circle avatar avatar-right avatar-anon", title: "Anonymous author" %>
      <% end %>
    </p>
  </div>
  <p id="share" class="share">
    <span class="left">
        <% star_class = "star" + (current_user && current_user.favorited?(joke) ? " favorited" : "") %>
        <%= link_to "Favorite Me!", favorite_toggle_joke_path(joke), :class => star_class, :method => :get, :remote => true, :title => "Toggle Favorite"%>
        |
          <%= render :partial => "shared/votes", :locals => {:joke => joke, :upvote_path => upvote_joke_path(joke), :downvote_path => downvote_joke_path(joke), :id => "joke_#{joke.id}"} %>
        | <%= link_to "Fork this joke", new_joke_alternate_punchline_path(joke), :method => :get, :remote => true, :title => "Create an alternate punchline", :class => "fork" %>
        |
          <a id="tags" class="fake_link">Tags</a>
        |
          <a id="permalink" class="fake_link">Permalink</a> 
        | <a id="share-link" class="fake_link">Share</a>
      </span>
      <span class="share-bar-right">
        <span class="inline-joke-edit">
        <% if !current_user.nil? && current_user.is_admin %>
          <%= link_to("Delete", joke_path(joke),:method => "delete", :confirm => "You sure?") %> | 
          <%= check_box_tag("joke-#{joke.id}", value = joke.is_kid_safe, checked = joke.is_kid_safe, :class => "ajax-checkbox joke-checkbox", "data-href" => is_kid_safe_toggle_joke_path(joke)) %> Is Kid Safe?
        <% end %>
        <% if joke.user %>
          <% if joke.user == current_user %>[<%= link_to "Edit joke", edit_joke_path(joke), :method => :get, data: {toggle: "modal", remote: true, target: "#add-joke"}%>]<% end %>
        <% end %>
      </span>
        <% if joke.jokeler_url %> <%= link_to image_tag("jokeler.jpg", :size => "20x20", :title =>"The Jokeler strikes again!"), joke.jokeler_url %> <% end %>
        <%= image_tag("info.png", :size => "16x16", :class=>"qtip-joke", "data-joke-id" => joke.id, "data-on-joke" => "true") %>
      </span>
    </span>
  </span>

  <% if joke.has_forks?(is_clean_mode?) %>
    <p id="alternate-punchlines-button"><%= link_to raw("This joke has <strong>forked</strong>! Click to see the <strong>alternate punchlines</strong>!"), joke_alternate_punchlines_path(joke), :method => :get, :remote => true, :rel => "nofollow" %></p>
    <span id="alternate_punchlines"></span>
  <% end %>

  <p id="refresh-joke" class="refresh-joke"><%= link_to raw("See another <strong>random joke!</strong>"), refresh_joke_home_path, :method => :get, :remote => true %></p>

</div>
